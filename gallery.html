<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="preload" as="image" href="images/logo.svg"/>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>The Wedding Crashers — Gallery</title>
  <meta http-equiv="Cache-Control" content="no-store, must-revalidate"/>

  <style>
    :root{ --pink:#f19bb8; --bg:#ffffff; --text:#111216; --muted:#757575; }
    *{ box-sizing:border-box; }
    body{ margin:0; background:var(--bg); color:var(--text); font-family:'Hillstown Sans', Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }

    /* Pink nav */
    .nav{ background:var(--pink); position:sticky; top:0; z-index:40; }
    .nav-inner{ height:66px; display:flex; align-items:center; justify-content:center; }
    .menu{ display:flex; gap:22px; align-items:center; justify-content:center; }
    .menu a{ color:#fff; text-decoration:none; text-transform:uppercase; letter-spacing:.14em; font-weight:400; font-size:14px; line-height:1; padding:8px 2px; }
    .menu a:hover{ text-decoration:underline; }

    main{ max-width:1200px; margin:0 auto; padding:28px 16px 60px; }

    .intro{ text-align:center; margin:8px 0 20px; color:var(--muted); font-size:14px; }

    /* Responsive grid (kept exactly like your current site) */
    .grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:14px; }
    .card{ position:relative; overflow:hidden; border-radius:14px; background:#f7f7f7; box-shadow:0 8px 24px rgba(0,0,0,.06); cursor:pointer; }
    .card img{ width:100%; height:100%; object-fit:cover; display:block; aspect-ratio: 3/2; }
    .ph{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:12px; color:#999; background:#fafafa; border:1px dashed #e5e5e5; }

    /* Lightbox (kept) */
    .lightbox{ position:fixed; inset:0; background:rgba(0,0,0,.85); display:none; align-items:center; justify-content:center; padding:24px; z-index:1000; }
    .lightbox.open{ display:flex; }
    .lightbox img{ max-width:92vw; max-height:92vh; border-radius:10px; box-shadow:0 20px 60px rgba(0,0,0,.4); }
    .lb-close{ position:fixed; top:16px; right:16px; background:#fff; border:none; border-radius:999px; width:40px; height:40px; font-size:20px; cursor:pointer; box-shadow:0 6px 20px rgba(0,0,0,.2); }
    .lb-prev, .lb-next{ position:fixed; top:50%; transform:translateY(-50%); background:#fff; border:none; border-radius:999px; width:48px; height:48px; font-size:18px; cursor:pointer; box-shadow:0 6px 20px rgba(0,0,0,.2); }
    .lb-prev{ left:16px; } .lb-next{ right:16px; }

    .note{ margin:18px auto; max-width:780px; color:#666; background:#fff5f9; border:1px solid #ffd3e3; padding:12px 14px; border-radius:10px; display:none; }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="nav-inner">
      <div class="menu" role="navigation" aria-label="Main">
        <a href="index.html">Home</a>
        <a href="packages.html">Packages</a>
        <a href="gallery.html">Gallery</a>
        <a href="video.html">Video</a>
        <a href="contact.html">Contact</a>
      </div>
    </div>
  </nav>

  <main>
    <p class="intro">Tap any image to view larger.</p>
    <div id="grid" class="grid" aria-live="polite"></div>
    <div id="emptyNote" class="note">No images found with the usual names. If your files use different names/paths, tell me a couple of examples and I’ll wire them in.</div>
  </main>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" aria-modal="true" role="dialog">
    <button class="lb-close" aria-label="Close">&times;</button>
    <button class="lb-prev" aria-label="Previous">&#9664;</button>
    <img id="lbImg" alt="">
    <button class="lb-next" aria-label="Next">&#9654;</button>
  </div>

  <script>
    // Thumbnails-first gallery: prefer images/small for grid, images/large for lightbox.
    // Falls back gracefully to originals and to legacy folders (Images/, assets/images) and extension variants.
    const MAX = 120;
    const exts = ["jpg","jpeg","png","webp","JPG","JPEG","PNG","WEBP"];
    const bases = ["images","Images","assets/images"];

    function buildCandidates(i){
      const originals = [].concat(
        exts.map(e=>`images/3-${i}.`+e),
        exts.map(e=>`images/${i}.`+e),
        exts.map(e=>`images/(${i}).`+e),
        // legacy alt folders
        ...bases.map(b => exts.map(e=>`${b}/3-${i}.`+e)),
        ...bases.map(b => exts.map(e=>`${b}/${i}.`+e)),
      );
      const thumbs = originals.map(p => p.replace(/(^|\/)images(\/|$)/, "$1images/small$2"));
      const larges = originals.map(p => p.replace(/(^|\/)images(\/|$)/, "$1images/large$2"));
      return {thumbs, larges, originals};
    }

    const v = Date.now().toString().slice(0,10); // cache-buster
    const grid = document.getElementById('grid');
    const emptyNote = document.getElementById('emptyNote');
    const found = []; // [{thumb, full}]

    function probe(src){ 
      return new Promise(res=>{
        const img = new Image();
        const q = src + (src.includes('?')?'&':'?') + 'v=' + v;
        img.onload  = () => res(q);
        img.onerror = () => res(null);
        img.src = q;
      });
    }

    async function detect(){
      for(let i=1;i<=MAX;i++){
        const {thumbs, larges, originals} = buildCandidates(i);
        let thumb=null, full=null;

        for(const t of thumbs){ thumb = await probe(t); if(thumb) break; }
        for(const L of larges){ full = await probe(L); if(full) break; }
        if(!full){
          for(const o of originals){ full = await probe(o); if(full) break; }
        }

        if(thumb || full){
          found.push({thumb: thumb || full, full: full || thumb});
        }
      }
      render();
    }

    function render(){
      if(found.length === 0){ emptyNote.style.display = 'block'; return; }
      found.forEach(({thumb, full})=>{
        const card = document.createElement('div');
        card.className = 'card';

        const ph = document.createElement('div');
        ph.className = 'ph';
        ph.textContent = 'Loading…';

        const img = document.createElement('img');
        img.loading = 'lazy';
        img.decoding = 'async';
        img.src = thumb;
        img.alt = '';
        img.width = 900; img.height = 600; // CLS hint
        img.addEventListener('load', ()=> ph.remove());
        img.addEventListener('error', ()=> card.remove());

        card.appendChild(ph);
        card.appendChild(img);
        card.addEventListener('click', ()=> openLightbox(full));
        grid.appendChild(card);
      });
    }

    // Lightbox (kept the same behaviour)
    const lb = document.getElementById('lightbox');
    const lbImg = document.getElementById('lbImg');
    const btnClose = lb.querySelector('.lb-close');
    const btnPrev = lb.querySelector('.lb-prev');
    const btnNext = lb.querySelector('.lb-next');
    let idx = -1;

    function openLightbox(src){ idx = found.findIndex(x=>x.full===src); lbImg.src = src; lb.classList.add('open'); }
    function closeLightbox(){ lb.classList.remove('open'); lbImg.src=''; }
    function prev(){ if(found.length){ idx=(idx-1+found.length)%found.length; lbImg.src = found[idx].full; } }
    function next(){ if(found.length){ idx=(idx+1)%found.length; lbImg.src = found[idx].full; } }

    btnClose.addEventListener('click', closeLightbox);
    btnPrev.addEventListener('click', prev);
    btnNext.addEventListener('click', next);
    lb.addEventListener('click', (e)=>{ if(e.target===lb) closeLightbox(); });
    document.addEventListener('keydown', (e)=>{ if(!lb.classList.contains('open')) return; if(e.key==='Escape') closeLightbox(); if(e.key==='ArrowLeft') prev(); if(e.key==='ArrowRight') next(); });

    detect();
  </script>

  <!-- cache-buster for internal links (kept) -->
  <script>
  (function(){
    const version = new Date().toISOString().slice(0,13).replace(/\D/g,'');
    document.querySelectorAll('a[href$=".html"]').forEach(a=>{
      try{
        const url = new URL(a.href, location.origin);
        if(url.origin === location.origin){
          url.searchParams.set('v', version);
          a.href = url.toString();
        }
      }catch(e){}
    });
  })();
  </script>
</body>
</html>
